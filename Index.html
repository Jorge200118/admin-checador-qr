<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Checador QR</title>
    <link rel="stylesheet" href="Admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <i class="fas fa-qrcode"></i>
            <h2>Checador QR</h2>
        </div>
        
        <nav class="nav-menu">
            <ul>
                <li class="nav-item active">
                    <a href="#dashboard" data-section="dashboard">
                        <i class="fas fa-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#empleados" data-section="empleados">
                        <i class="fas fa-users"></i>
                        <span>Empleados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#horarios" data-section="horarios">
                        <i class="fas fa-clock"></i>
                        <span>Horarios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#registros" data-section="registros">
                        <i class="fas fa-list"></i>
                        <span>Registros</span>
                    </a>
                </li>
           <!-- <li class="nav-item">
                    <a href="#reportes" data-section="reportes">
                        <i class="fas fa-chart-line"></i>
                        <span>Reportes</span>
                    </a>
                </li> -->
                <li class="nav-item">
                    <a href="#justificaciones" data-section="justificaciones">
                        <i class="fas fa-file-medical"></i>
                        <span>Justificaciones</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#estadisticas" data-section="estadisticas">
                        <i class="fas fa-chart-pie"></i>
                        <span>Estad√≠sticas</span>
                    </a>
                </li>
                <li class="nav-item" style="display:none">
                    <a href="#creditos" data-section="creditos">
                        <i class="fas fa-credit-card"></i>
                        <span>Cr√©ditos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#configuracion" data-section="configuracion">
                        <i class="fas fa-cog"></i>
                        <span>Configuraci√≥n</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="header-actions">
                <div class="status-indicator">
                    <span class="status-dot online"></span>
                    <span>Sistema activo</span>
                </div>
                <!-- ‚îÄ‚îÄ BADGE DE ALERTAS ‚îÄ‚îÄ -->
                <button class="btn btn-alertas" id="btnAlertas" onclick="abrirPanelAlertas()" title="Alertas del d√≠a" style="position:relative;background:#1e293b;border:1px solid #334155;color:#94a3b8;padding:8px 14px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:6px;font-size:14px;">
                    <i class="fas fa-bell"></i>
                    <span id="badgeAlertas" style="position:absolute;top:-6px;right:-6px;background:#ef4444;color:#fff;border-radius:50%;width:18px;height:18px;font-size:10px;font-weight:700;align-items:center;justify-content:center;display:none;"></span>
                </button>
                <button class="btn btn-logout" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt"></i>
                    Salir
                </button>
                <div class="user-info" style="margin-right: 15px; color: #666;">
                    <i class="fas fa-user"></i>
                    <span id="userNameDisplay"></span>
                    <span style="font-size: 12px;">(<span id="userSucursalDisplay"></span>)</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="empleadosPresentes">0</h3>
                        <p>Empleados Presentes</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="registrosHoy">0</h3>
                        <p>Registros Hoy</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="llegadasTarde">0</h3>
                        <p>Llegadas Tarde</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tablet-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="tabletsActivas">2</h3>
                        <p>Tablets Activas</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Empleados Presentes Hoy</h3>
                        <button class="btn btn-sm btn-primary" onclick="refreshDashboard()">
                            <i class="fas fa-refresh"></i> Actualizar
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="empleadosPresentesTable">
                                <thead>
                                    <tr>
                                        <th>Empleado</th>
                                        <th>Entrada</th>
                                        <th>Salida Esperada</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>√öltimos Registros</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="ultimosRegistrosTable">
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Empleado</th>
                                        <th>Tipo</th>
                                        <th>Tablet</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Empleados Section -->
        <section id="empleados" class="content-section">
            <div class="section-header">
                <h2>Gesti√≥n de Empleados</h2>
                <div class="header-actions-group">
                    <button class="btn btn-info" id="btnTutorialEmpleado" onclick="iniciarTutorialEmpleado()">
                        <i class="fas fa-question-circle"></i> Tutorial
                    </button>
                    <button class="btn btn-primary" id="btnNuevoEmpleado">
                        <i class="fas fa-plus"></i> Nuevo Empleado
                    </button>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <input type="text" id="searchEmpleados" placeholder="Buscar empleados..." class="form-input">
                    <select id="filterHorario" class="form-select">
                        <option value="">Todos los horarios</option>
                        <!-- Options loaded by JavaScript -->
                    </select>
                    <select id="filterEstado" class="form-select">
                        <option value="">Todos los estados</option>
                        <option value="1">Activos</option>
                        <option value="0">Inactivos</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="empleadosTable">
                            <thead>
                                <tr>
                                    <th>Foto</th>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Sucursal</th>
                                    <th>Puesto</th>
                                    <th>Horario</th>
                                    <th>Estado</th>
                                    <th>Fecha Alta</th>
                                    <th>Expediente</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Horarios Section -->
        <section id="horarios" class="content-section">
            <div class="section-header">
                <h2>Gesti√≥n de Horarios</h2>
                <button class="btn btn-primary" id="btnNuevoHorario">
                    <i class="fas fa-plus"></i> Nuevo Horario
                </button>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="horariosTable">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripci√≥n</th>
                                    <th>Bloques</th>
                                    <th>Empleados</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registros Section -->
        <section id="registros" class="content-section">
            <!-- Header con per√≠odo y estad√≠sticas -->
            <div class="registros-header">
                <div class="periodo-info">
                    <h2>Registros de Asistencia</h2>
                    <div class="periodo-actual">
                        <span class="periodo-label">Per√≠odo:</span>
                        <span class="periodo-fechas" id="periodoActual">18/11/2025 - 18/11/2025</span>
                    </div>
                </div>
                
                <!-- Estad√≠sticas r√°pidas -->
                <div class="stats-quick">
                    <div class="stat-item">
                        <span class="stat-label">Registros sin check</span>
                        <span class="stat-number" id="registrosSinCheck">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Registros</span>
                        <span class="stat-number" id="totalRegistros">132</span>
                    </div>
                </div>
            </div>

            <!-- Filtros mejorados -->
            <div class="filters-advanced">
                <div class="filters-row">
                    <!-- Filtros de fecha -->
                    <div class="filter-group dates">
                        <label>Per√≠odo:</label>
                        <div class="date-inputs">
                            <input type="date" id="fechaInicio" class="form-input" placeholder="Fecha inicio">
                            <span class="date-separator">-</span>
                            <input type="date" id="fechaFin" class="form-input" placeholder="Fecha fin">
                        </div>
                    </div>
                    
                    <!-- Filtro de empleado con autocompletar -->
                    <div class="filter-group">
                        <label>Empleado:</label>
                        <div class="autocomplete-container">
                            <input type="text" id="filterEmpleadoBusqueda" class="form-input" 
                                placeholder="Buscar empleado..." autocomplete="off">
                            <div id="empleadosSuggestions" class="autocomplete-suggestions"></div>
                            <input type="hidden" id="filterEmpleado" value="">
                        </div>
                    </div>
                    
                    <!-- Filtro de tipo -->
                    <div class="filter-group">
                        <label>Tipo:</label>
                        <select id="filterTipo" class="form-select">
                            <option value="">TODOS LOS TIPOS</option>
                            <option value="ENTRADA">Entradas</option>
                            <option value="SALIDA">Salidas</option>
                        </select>
                    </div>
                    
                    <!-- Filtro de sucursal -->
                    <div class="filter-group">
                        <label>Sucursal:</label>
                        <select id="filterSucursal" class="form-select">
                            <option value="">TODAS LAS SUCURSALES</option>
                            <option value="MATRIZ">MATRIZ</option>
                            <option value="TAMARAL">TAMARAL</option>
                            <option value="CABOS">CABOS</option>
                            <option value="LA PAZ">LA PAZ</option>
                            <option value="SAN JOSE">SAN JOSE</option>
                            <option value="CULIACAN">CULIACAN</option>
                            <option value="JUAN JOSE RIOS">JUAN JOSE RIOS</option>
                            <option value="EL FUERTE">EL FUERTE</option>
                        </select>
                    </div>
                    
                    <!-- Filtro de puesto -->
                    <div class="filter-group">
                        <label>Puesto:</label>
                        <select id="filterPuesto" class="form-select">
                            <option value="">TODOS LOS PUESTOS</option>
                            <option value="VENTAS">VENTAS</option>
                            <option value="CHOFER">CHOFER</option>
                            <option value="TRABAJADOR DE PATIO">TRABAJADOR DE PATIO</option>
                            <option value="AUXILIAR CONTABLE">AUXILIAR CONTABLE</option>
                            <option value="ENCARGADO DE SUCURSAL">ENCARGADO DE SUCURSAL</option>
                            <option value="CAJERA">CAJERA</option>
                            <option value="ALMACEN">ALMACEN</option>
                            <!-- M√°s opciones cargadas din√°micamente -->
                        </select>
                    </div>
                </div>
                
                <!-- Botones de acci√≥n -->
                <div class="filter-actions">
                    <button class="btn btn-primary filter-btn" onclick="filtrarRegistros()">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
<button class="btn btn-warning" onclick="mostrarResumenGeneral()" title="Resumen general de todos los empleados">
                        <i class="fas fa-table"></i> Resumen General
                    </button>
                    <button class="btn btn-secondary" onclick="limpiarFiltros()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>

            <!-- Secci√≥n de descarga de faltas mejorada -->
            <div class="faltas-download-section">
                <div class="section-title">
                    <i class="fas fa-download"></i>
                    <strong>Descargar Faltas por Rango</strong>
                </div>
                
                <div class="download-controls">
                    <div class="date-range-group">
                        <label>Desde:</label>
                        <input type="date" id="fecha-inicio-faltas" class="form-input-small">
                        
                        <label>Hasta:</label>
                        <input type="date" id="fecha-fin-faltas" class="form-input-small">
                    </div>
                    
                    <button id="btn-descargar-faltas" onclick="obtenerEmpleadosSinEntradaRango(event)" class="btn btn-success">
                        <i class="fas fa-file-excel"></i> Descargar Rango
                    </button>
                </div>
                
                <div class="download-hint">
                    üí° Descarga todas las faltas del per√≠odo seleccionado en un solo Excel
                </div>
            </div>


            <!-- Controles de tabla -->
            <div class="table-controls">
                
                <div class="table-actions">
                    <button class="btn-icon" title="Imprimir" onclick="imprimirRegistros()">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="btn-icon" title="Exportar Excel" onclick="exportarRegistros('excel')">
                        <i class="fas fa-file-excel"></i>
                    </button>
                    <button class="btn-icon" title="Exportar PDF" onclick="exportarRegistros('pdf')">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                    <button class="btn-icon" title="Actualizar" onclick="reloadRegistros()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn-icon" title="Configurar columnas" onclick="configurarColumnas()">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- Tabla principal -->
            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="registrosTable" class="registros-table-advanced">
                            <!-- Modificar tu thead -->
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAllRegistros" onchange="toggleSelectAll()">
                                    </th>
                                    <th>Empleado</th>
                                    <th>Fecha</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Hrs Trabajadas</th>
                                    <th>Hrs Objetivo</th>
                                    <th>Estatus</th>
                                    <th>Tablet</th>
                                    <th>Foto</th>
                                    <th>Todas las fotos</th> <!-- NUEVA COLUMNA -->
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Paginaci√≥n -->
          <!--    <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Mostrando registros del 1 al 10 de un total de 132</span>
                </div>
                
              <!--   <div class="pagination-controls">
                    <button class="btn-pagination" id="btnAnterior" onclick="cambiarPagina(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    
                    <div class="pagination-numbers" id="paginationNumbers">
                        <button class="btn-page active">1</button>
                        <button class="btn-page">2</button>
                        <button class="btn-page">3</button>
                        <span class="pagination-dots">...</span>
                        <button class="btn-page">14</button>
                    </div>
                    
                    <button class="btn-pagination" id="btnSiguiente" onclick="cambiarPagina(1)">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>-->
        </section>

        <!-- Reportes Section 
        <section id="reportes" class="content-section">
            <div class="section-header">
                <h2>Reportes y Estad√≠sticas</h2>
            </div>

            <div class="reports-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Reporte de Asistencia</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Per√≠odo:</label>
                            <div class="date-range">
                                <input type="date" id="reporteFechaInicio" class="form-input">
                                <span>hasta</span>
                                <input type="date" id="reporteFechaFin" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Empleado:</label>
                            <select id="reporteEmpleado" class="form-select">
                                <option value="">Todos</option>
                                <!-- Options loaded by JavaScript 
                            </select>
                        </div>
                        <button onclick="generarReporteAsistencia()" class="btn btn-primary">
                            üìÑ Generar Reporte
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Estad√≠sticas del Mes</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="chartAsistencia" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section> -->

        <!-- Justificaciones Section -->
        <section id="justificaciones" class="content-section">
            <div class="section-header">
                <h2>Gesti√≥n de Justificaciones</h2>
                <button class="btn btn-primary" id="btnNuevaJustificacion" onclick="abrirModalJustificacion()">
                    <i class="fas fa-plus"></i> Nueva Justificaci√≥n
                </button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <select id="filterJustTipo" class="form-select" onchange="filtrarJustificaciones()">
                        <option value="">Todos los tipos</option>
                        <option value="VACACION">Vacaciones</option>
                        <option value="INCAPACIDAD">Incapacidad</option>
                        <option value="PERMISO">Permiso</option>
                    </select>
                    <input type="text" id="searchJustEmpleado" class="form-input"
                        placeholder="Buscar empleado..." oninput="filtrarJustificaciones()">
                    <input type="date" id="filterJustFechaInicio" class="form-input" onchange="filtrarJustificaciones()">
                    <input type="date" id="filterJustFechaFin" class="form-input" onchange="filtrarJustificaciones()">
                    <select id="filterJustSucursal" class="form-select" onchange="filtrarJustificaciones()">
                        <option value="">Todas las sucursales</option>
                        <option value="MATRIZ">MATRIZ</option>
                        <option value="TAMARAL">TAMARAL</option>
                        <option value="CABOS">CABOS</option>
                        <option value="LA PAZ">LA PAZ</option>
                        <option value="SAN JOSE">SAN JOSE</option>
                        <option value="CULIACAN">CULIACAN</option>
                        <option value="JUAN JOSE RIOS">JUAN JOSE RIOS</option>
                        <option value="EL FUERTE">EL FUERTE</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="justificacionesTable">
                            <thead>
                                <tr>
                                    <th>Empleado</th>
                                    <th>Sucursal</th>
                                    <th>Tipo</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>D√≠as</th>
                                    <th>Motivo</th>
                                    <th>Creado por</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuraci√≥n Section -->
        <section id="configuracion" class="content-section">
            <div class="section-header">
                <h2>Configuraci√≥n del Sistema</h2>
            </div>

            <div class="config-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Tablets Registradas</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="tabletsTable">
                                <thead>
                                    <tr>
                                        <th>ID Tablet</th>
                                        <th>Ubicaci√≥n</th>
                                        <th>Estado</th>
                                        <th>√öltimo Ping</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Configuraci√≥n General</h3>
                    </div>
                    <div class="card-body">
                        <div class="config-form">
                            <div class="form-group">
                                <label>Tolerancia por defecto (minutos):</label>
                                <input type="number" id="toleranciaDefecto" class="form-input" value="15">
                            </div>
                            <div class="form-group">
                                <label>Tama√±o m√°ximo de foto (MB):</label>
                                <input type="number" id="maxFotoSize" class="form-input" value="5">
                            </div>
                            <div class="form-group">
                                <label>Auto-logout admin (minutos):</label>
                                <input type="number" id="autoLogout" class="form-input" value="60">
                            </div>
                            <button class="btn btn-primary" onclick="guardarConfiguracion()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== SECCI√ìN ESTAD√çSTICAS DE PLANTILLA ==================== -->
        <section id="estadisticas" class="content-section">
            <!-- Header -->
            <div class="section-header">
                <div>
                    <h2 style="margin:0 0 2px">Estad√≠sticas de Plantilla</h2>
                    <span id="estActualizadoEn" style="font-size:12px;color:#94a3b8"></span>
                </div>
                <div class="header-actions-group">
                    <button class="btn btn-secondary" onclick="cargarEstadisticas()" title="Recargar datos">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-primary" onclick="exportarEstadisticasExcel()">
                        <i class="fas fa-file-excel"></i> Exportar
                    </button>
                </div>
            </div>

            <!-- KPIs ‚Äî 4 tarjetas con barra de color superior -->
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;">
                <!-- Activos -->
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05);">
                    <div style="height:4px;background:linear-gradient(90deg,#3b82f6,#60a5fa)"></div>
                    <div style="padding:20px 20px 18px">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
                            <span style="font-size:12px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em">Plantilla Activa</span>
                            <div style="width:36px;height:36px;border-radius:9px;background:#eff6ff;display:flex;align-items:center;justify-content:center">
                                <i class="fas fa-users" style="color:#3b82f6;font-size:15px"></i>
                            </div>
                        </div>
                        <div id="estTotalActivos" style="font-size:2rem;font-weight:800;color:#0f172a;line-height:1">‚Äì</div>
                        <div style="font-size:12px;color:#94a3b8;margin-top:6px">empleados activos hoy</div>
                    </div>
                </div>
                <!-- Bajas -->
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05);">
                    <div style="height:4px;background:linear-gradient(90deg,#ef4444,#f87171)"></div>
                    <div style="padding:20px 20px 18px">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
                            <span style="font-size:12px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em">Bajas (12 meses)</span>
                            <div style="width:36px;height:36px;border-radius:9px;background:#fef2f2;display:flex;align-items:center;justify-content:center">
                                <i class="fas fa-user-minus" style="color:#ef4444;font-size:15px"></i>
                            </div>
                        </div>
                        <div id="estTotalBajas" style="font-size:2rem;font-weight:800;color:#0f172a;line-height:1">‚Äì</div>
                        <div style="font-size:12px;color:#94a3b8;margin-top:6px">√∫ltimos 365 d√≠as</div>
                    </div>
                </div>
                <!-- Ingresos -->
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05);">
                    <div style="height:4px;background:linear-gradient(90deg,#10b981,#34d399)"></div>
                    <div style="padding:20px 20px 18px">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
                            <span style="font-size:12px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em">Nuevos Ingresos</span>
                            <div style="width:36px;height:36px;border-radius:9px;background:#f0fdf4;display:flex;align-items:center;justify-content:center">
                                <i class="fas fa-user-plus" style="color:#10b981;font-size:15px"></i>
                            </div>
                        </div>
                        <div id="estIngresos30" style="font-size:2rem;font-weight:800;color:#0f172a;line-height:1">‚Äì</div>
                        <div style="font-size:12px;color:#94a3b8;margin-top:6px">√∫ltimos 30 d√≠as</div>
                    </div>
                </div>
                <!-- Antig√ºedad -->
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05);">
                    <div style="height:4px;background:linear-gradient(90deg,#f59e0b,#fbbf24)"></div>
                    <div style="padding:20px 20px 18px">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
                            <span style="font-size:12px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em">Antig√ºedad Prom.</span>
                            <div style="width:36px;height:36px;border-radius:9px;background:#fffbeb;display:flex;align-items:center;justify-content:center">
                                <i class="fas fa-star" style="color:#f59e0b;font-size:15px"></i>
                            </div>
                        </div>
                        <div id="estAntig√ºedad" style="font-size:2rem;font-weight:800;color:#0f172a;line-height:1">‚Äì</div>
                        <div style="font-size:12px;color:#94a3b8;margin-top:6px">a√±os en promedio</div>
                    </div>
                </div>
            </div>

            <!-- Fila 1: Donas + Ingresos por mes -->
            <div style="display:grid;grid-template-columns:1fr 1.6fr;gap:16px;margin-bottom:16px;align-items:start;">
                <!-- Col izquierda: 2 donas apiladas -->
                <div style="display:flex;flex-direction:column;gap:16px;">
                    <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                        <div style="padding:14px 20px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:8px">
                            <div style="width:8px;height:8px;border-radius:50%;background:#3b82f6"></div>
                            <span style="font-size:13px;font-weight:600;color:#0f172a">Distribuci√≥n por Sexo</span>
                        </div>
                        <div style="padding:16px 20px 20px">
                            <canvas id="chartSexo" style="max-height:200px"></canvas>
                        </div>
                    </div>
                    <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                        <div style="padding:14px 20px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:8px">
                            <div style="width:8px;height:8px;border-radius:50%;background:#8b5cf6"></div>
                            <span style="font-size:13px;font-weight:600;color:#0f172a">Estado Civil</span>
                        </div>
                        <div style="padding:16px 20px 20px">
                            <canvas id="chartEstadoCivil" style="max-height:200px"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Col derecha: Ingresos por mes (barras verticales grandes) -->
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                    <div style="padding:14px 20px 12px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center">
                        <div style="display:flex;align-items:center;gap:8px">
                            <div style="width:8px;height:8px;border-radius:50%;background:#10b981"></div>
                            <span style="font-size:13px;font-weight:600;color:#0f172a">Ingresos por Mes</span>
                        </div>
                        <span style="font-size:11px;color:#94a3b8">A√±o en curso</span>
                    </div>
                    <div style="padding:20px 20px 16px">
                        <canvas id="chartIngresosMes" style="min-height:320px"></canvas>
                    </div>
                </div>
            </div>

            <!-- Fila 2: Puestos + √Åreas (barras horizontales) -->
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                    <div style="padding:14px 20px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:8px">
                        <div style="width:8px;height:8px;border-radius:50%;background:#8b5cf6"></div>
                        <span style="font-size:13px;font-weight:600;color:#0f172a">Por Puesto</span>
                        <span style="font-size:11px;color:#94a3b8;margin-left:auto">Top 15</span>
                    </div>
                    <div style="padding:16px 20px 20px">
                        <canvas id="chartDepartamentos"></canvas>
                    </div>
                </div>
                <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                    <div style="padding:14px 20px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:8px">
                        <div style="width:8px;height:8px;border-radius:50%;background:#f59e0b"></div>
                        <span style="font-size:13px;font-weight:600;color:#0f172a">Por √Årea</span>
                        <span style="font-size:11px;color:#94a3b8;margin-left:auto">Top 15</span>
                    </div>
                    <div style="padding:16px 20px 20px">
                        <canvas id="chartAreas"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tabla de rotaci√≥n ‚Äî tarjeta full-width -->
            <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)">
                <div style="padding:14px 20px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;gap:8px">
                    <div style="width:8px;height:8px;border-radius:50%;background:#ef4444"></div>
                    <span style="font-size:13px;font-weight:600;color:#0f172a">√çndice de Rotaci√≥n</span>
                    <span style="font-size:11px;color:#94a3b8;margin-left:auto">√öltimos 6 meses ¬∑ <span style="color:#10b981">verde</span> &lt;2% ¬∑ <span style="color:#f59e0b">amarillo</span> 2‚Äì5% ¬∑ <span style="color:#ef4444">rojo</span> &gt;5%</span>
                </div>
                <div style="padding:0">
                    <table id="tablaRotacion" style="width:100%;border-collapse:collapse">
                        <thead>
                            <tr style="background:#f8fafc">
                                <th style="padding:10px 20px;text-align:left;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">Mes</th>
                                <th style="padding:10px 20px;text-align:right;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">P. Inicial</th>
                                <th style="padding:10px 20px;text-align:right;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">Altas</th>
                                <th style="padding:10px 20px;text-align:right;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">Bajas</th>
                                <th style="padding:10px 20px;text-align:right;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">P. Final</th>
                                <th style="padding:10px 20px;text-align:center;font-size:11px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid #f1f5f9">% Rotaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyRotacion">
                            <tr><td colspan="6" style="text-align:center;color:#64748b;padding:24px">Cargando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ==================== SECCI√ìN CONTROL DE CR√âDITOS ==================== -->
        <section id="creditos" class="content-section" style="display:none">
            <div class="section-header">
                <h2>Control de Cr√©ditos INFONAVIT / FONACOT</h2>
                <div class="header-actions-group">
                    <button class="btn btn-primary" onclick="exportarCreditosExcel()">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                </div>
            </div>

            <!-- KPIs cr√©ditos -->
            <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:20px;">
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(59,130,246,.15)"><i class="fas fa-home" style="color:#3b82f6"></i></div>
                    <div class="stat-info"><h3 id="credConInfonavit">‚Äì</h3><p>Con INFONAVIT</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(16,185,129,.15)"><i class="fas fa-credit-card" style="color:#10b981"></i></div>
                    <div class="stat-info"><h3 id="credConFonacot">‚Äì</h3><p>Con FONACOT</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(245,158,11,.15)"><i class="fas fa-layer-group" style="color:#f59e0b"></i></div>
                    <div class="stat-info"><h3 id="credConAmbos">‚Äì</h3><p>Con Ambos</p></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(239,68,68,.15)"><i class="fas fa-ban" style="color:#ef4444"></i></div>
                    <div class="stat-info"><h3 id="credSinCredito">‚Äì</h3><p>Sin Cr√©dito (activos)</p></div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters" style="margin-bottom:16px;">
                <div class="filter-group" style="flex-wrap:wrap;gap:10px;">
                    <input type="text" id="searchCreditos" placeholder="Buscar por nombre o ID..." class="form-input" oninput="filtrarTablaCreditos()" style="min-width:220px;">
                    <select id="filtroCreditoTipo" class="form-select" onchange="cargarCreditos()">
                        <option value="">Con alg√∫n cr√©dito</option>
                        <option value="infonavit">Solo INFONAVIT</option>
                        <option value="fonacot">Solo FONACOT</option>
                        <option value="ambos">Ambos cr√©ditos</option>
                        <option value="sin">Sin cr√©dito</option>
                    </select>
                    <select id="filtroCreditoDpto" class="form-select" onchange="cargarCreditos()">
                        <option value="">Todos los departamentos</option>
                    </select>
                    <select id="filtroCreditoStatus" class="form-select" onchange="cargarCreditos()">
                        <option value="">Activos e Inactivos</option>
                        <option value="1">Solo Activos</option>
                        <option value="0">Solo Bajas</option>
                    </select>
                </div>
            </div>

            <!-- Tabla -->
            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="tablaCreditosEmpleados">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Puesto</th>
                                    <th>Departamento</th>
                                    <th>INFONAVIT</th>
                                    <th>FONACOT</th>
                                    <th>Sueldo Diario</th>
                                    <th>Status</th>
                                    <th>Expediente</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyCreditos">
                                <tr><td colspan="9" style="text-align:center;color:#64748b">Cargando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="modalEmpleado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEmpleadoTitle">Nuevo Empleado</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">

                <!-- PASO 1: Buscar en n√≥mina (solo al crear) -->
                <div id="empBuscadorNomina" style="display:none; margin-bottom:16px;">
                    <label style="font-weight:600; display:block; margin-bottom:6px;">
                        Buscar empleado en n√≥mina:
                    </label>
                    <div style="position:relative;">
                        <input type="text" id="empBuscarInput" class="form-input"
                            placeholder="Nombre, apellido o c√≥digo..."
                            autocomplete="off"
                            style="padding-right:40px;">
                        <span id="empBuscarSpinner" style="display:none; position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:14px;">‚è≥</span>
                    </div>
                    <div id="empBuscarResultados" style="
                        display:none;
                        border:1px solid #ddd;
                        border-top:none;
                        border-radius:0 0 6px 6px;
                        max-height:240px;
                        overflow-y:auto;
                        background:#fff;
                        box-shadow:0 4px 8px rgba(0,0,0,0.1);
                    "></div>
                    <div id="empSeleccionado" style="
                        display:none;
                        margin-top:8px;
                        padding:10px 14px;
                        background:#f0fdf4;
                        border:1px solid #86efac;
                        border-radius:6px;
                        font-size:13px;
                    "></div>
                </div>

                <form id="formEmpleado" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>C√≥digo de Empleado:</label>
                        <input type="text" id="empCodigo" name="codigo" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre:</label>
                        <input type="text" id="empNombre" name="nombre" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Apellido:</label>
                        <input type="text" id="empApellido" name="apellido" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Sucursal:</label>
                        <select id="empSucursal" name="sucursal" class="form-select">
                            <option value="">Seleccionar sucursal</option>
                            <option value="MATRIZ">MATRIZ</option>
                            <option value="LA PAZ">LA PAZ</option>
                            <option value="SAN JOSE">SAN JOSE</option>
                            <option value="TAMARAL">TAMARAL</option>
                            <option value="CABOS">CABOS</option>
                            <option value="EL FUERTE">EL FUERTE</option>
                            <option value="JUAN JOSE RIOS">JUAN JOSE RIOS</option>
                            <option value="CULIACAN">CULIACAN</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puesto:</label>
                        <input type="text" id="empPuesto" name="puesto" class="form-input"
                            placeholder="Ej: VENTAS, ALMAC√âN, ENCARGADO DE PATIO">
                    </div>
                    <div class="form-group">
                        <label>Horario:</label>
                        <select id="empHorario" name="horario_id" class="form-select" required>
                            <!-- Options loaded by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Foto de Perfil:</label>
                        <input type="file" id="empFoto" name="foto" class="form-input" accept="image/*">
                        <div id="previewFoto" class="foto-preview"></div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="empTrabajaDomingo" name="trabaja_domingo">
                            Trabaja domingos
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalEmpleado')">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarEmpleado()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Justificaci√≥n -->
    <div id="modalJustificacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalJustificacionTitle">Nueva Justificaci√≥n</h3>
                <span class="close" onclick="closeModal('modalJustificacion')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formJustificacion">
                    <input type="hidden" id="justId">
                    <input type="hidden" id="justEmpleadoId">
                    <div class="form-group">
                        <label>Empleado: <span class="required-asterisk">*</span></label>
                        <div class="just-autocomplete-wrapper">
                            <input type="text" id="justEmpleadoBuscar" class="form-input"
                                placeholder="Escribe nombre o c√≥digo del empleado..."
                                autocomplete="off" required>
                            <div id="justEmpleadoResultados" class="just-autocomplete-results"></div>
                        </div>
                        <div id="justEmpleadoSeleccionado" class="just-empleado-badge" style="display:none;">
                            <span id="justEmpleadoNombre"></span>
                            <button type="button" class="just-badge-remove" onclick="limpiarEmpleadoJustificacion()">&times;</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tipo: <span class="required-asterisk">*</span></label>
                        <select id="justTipo" class="form-select" required>
                            <option value="">Seleccionar tipo...</option>
                            <option value="VACACION">Vacaciones</option>
                            <option value="INCAPACIDAD">Incapacidad</option>
                            <option value="PERMISO">Permiso</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha Inicio: <span class="required-asterisk">*</span></label>
                        <input type="date" id="justFechaInicio" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin: <span class="required-asterisk">*</span></label>
                        <input type="date" id="justFechaFin" class="form-input" required>
                    </div>
                    <div id="justDiasResumen" class="just-dias-resumen" style="display:none;"></div>
                    <div class="form-group">
                        <label>Motivo / Notas:</label>
                        <textarea id="justMotivo" class="form-input" rows="3"
                            placeholder="Descripci√≥n o notas adicionales..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalJustificacion')">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarJustificacion" onclick="guardarJustificacion()">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <script>
    // Configuraci√≥n global para evitar errores
    window.ADMIN_CONFIG = {
        apiUrl: 'http://localhost:3000/api'
    };
    </script>

    <!-- Verificaci√≥n de sesi√≥n - DEBE IR PRIMERO -->
    <script>
        // Verificar sesi√≥n antes de cargar la p√°gina
        (function() {
            const session = localStorage.getItem('session_sucursal') ||
                           sessionStorage.getItem('session_sucursal');

            if (!session) {
                // No hay sesi√≥n, redirigir al login
                window.location.href = '../login-sucursal.html';
                return;
            }

            try {
                const sessionData = JSON.parse(session);

                // Verificar que la sesi√≥n no haya expirado (24 horas)
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);

                if (hoursSinceLogin > 24) {
                    // Sesi√≥n expirada
                    localStorage.removeItem('session_sucursal');
                    sessionStorage.removeItem('session_sucursal');
                    window.location.href = '../login-sucursal.html';
                    return;
                }

                // Sesi√≥n v√°lida, guardar datos globalmente
                window.currentUser = sessionData;

                // Mostrar informaci√≥n del usuario cuando la p√°gina cargue
                window.addEventListener('DOMContentLoaded', function() {
                    const userNameEl = document.getElementById('userNameDisplay');
                    const userSucursalEl = document.getElementById('userSucursalDisplay');

                    if (userNameEl) userNameEl.textContent = sessionData.nombreCompleto;
                    if (userSucursalEl) userSucursalEl.textContent = sessionData.sucursal;
                });

            } catch (error) {
                // Sesi√≥n corrupta
                localStorage.removeItem('session_sucursal');
                sessionStorage.removeItem('session_sucursal');
                window.location.href = '../login-sucursal.html';
            }
        })();

        // Funci√≥n para cerrar sesi√≥n
        function cerrarSesion() {
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                // Limpiar sesiones
                localStorage.removeItem('session_sucursal');
                sessionStorage.removeItem('session_sucursal');

                // Limpiar datos del usuario
                window.currentUser = null;

                // Redirigir al login
                window.location.href = '../login-sucursal.html';
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="Admin.js"></script>
<!-- MODAL DE TUTORIAL PARA NUEVO EMPLEADO -->
<div id="modalTutorialEmpleado" class="modal">
    <div class="modal-content modal-tutorial">
        <div class="modal-header">
            <h3><i class="fas fa-graduation-cap"></i> Tutorial: C√≥mo dar de alta un nuevo empleado</h3>
            <span class="close" onclick="cerrarTutorialEmpleado()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Navegaci√≥n de pasos -->
            <div class="tutorial-progress">
                <div class="step-indicator active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Introducci√≥n</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Datos b√°sicos</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Ubicaci√≥n</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Horario</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Foto y extras</div>
                </div>
            </div>

            <!-- Contenido de pasos -->
            <div class="tutorial-content">
                <!-- Paso 1: Introducci√≥n -->
                <div class="tutorial-step active" data-step="1">
                    <div class="step-icon">
                        <i class="fas fa-user-plus fa-3x"></i>
                    </div>
                    <h3>Bienvenido al asistente de alta de empleados</h3>
                    <p>Este tutorial te guiar√° paso a paso para registrar un nuevo empleado en el sistema de checador QR.</p>

                    <div class="info-box">
                        <h4><i class="fas fa-info-circle"></i> ¬øQu√© necesitas tener listo?</h4>
                        <ul>
                            <li><i class="fas fa-check"></i> C√≥digo √∫nico del empleado</li>
                            <li><i class="fas fa-check"></i> Nombre completo</li>
                            <li><i class="fas fa-check"></i> Sucursal donde trabajar√°</li>
                            <li><i class="fas fa-check"></i> Puesto o cargo</li>
                            <li><i class="fas fa-check"></i> Horario asignado</li>
                            <li><i class="fas fa-check"></i> Foto de perfil (opcional)</li>
                        </ul>
                    </div>

                    <div class="time-estimate">
                        <i class="fas fa-clock"></i> Tiempo estimado: <strong>2-3 minutos</strong>
                    </div>
                </div>

                <!-- Paso 2: Datos b√°sicos -->
                <div class="tutorial-step" data-step="2">
                    <h3><i class="fas fa-id-card"></i> Paso 1: Datos b√°sicos del empleado</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>C√≥digo de Empleado:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: EMP001" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>C√≥digo de Empleado</h4>
                            <p>Es el identificador √∫nico del empleado. Puede ser un n√∫mero de n√≥mina, un c√≥digo alfanum√©rico, etc.</p>
                            <div class="tips">
                                <strong>üí° Consejos:</strong>
                                <ul>
                                    <li>Usa un formato consistente (Ej: EMP001, EMP002)</li>
                                    <li>No puede repetirse con otro empleado</li>
                                    <li>Aseg√∫rate de que sea f√°cil de recordar</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Nombre:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: Juan" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Nombre</h4>
                            <p>Nombre(s) del empleado.</p>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Apellido:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: P√©rez Garc√≠a" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Apellido</h4>
                            <p>Apellido(s) del empleado.</p>
                        </div>
                    </div>
                </div>

                <!-- Paso 3: Ubicaci√≥n y puesto -->
                <div class="tutorial-step" data-step="3">
                    <h3><i class="fas fa-building"></i> Paso 2: Sucursal y puesto de trabajo</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Sucursal:</label>
                            <select class="form-select demo-input" disabled>
                                <option>Seleccionar sucursal</option>
                                <option>MATRIZ</option>
                                <option>LA PAZ</option>
                                <option>TAMARAL</option>
                                <option>CABOS</option>
                            </select>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Sucursal</h4>
                            <p>Selecciona la sucursal donde el empleado estar√° asignado.</p>
                            <div class="tips">
                                <strong>üí° Importante:</strong>
                                <ul>
                                    <li>Esta informaci√≥n se usar√° para filtrar reportes</li>
                                    <li>El empleado solo aparecer√° en las tablets de su sucursal</li>
                                    <li>Puedes cambiar la sucursal despu√©s editando el empleado</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Puesto:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: VENTAS, ALMAC√âN, ENCARGADO" readonly>
                        </div>
                        <div class="field-explanation">
                            <h4>Puesto</h4>
                            <p>Especifica el cargo o puesto del empleado.</p>
                            <div class="tips">
                                <strong>üí° Ejemplos comunes:</strong>
                                <ul>
                                    <li>VENTAS</li>
                                    <li>CHOFER</li>
                                    <li>TRABAJADOR DE PATIO</li>
                                    <li>AUXILIAR CONTABLE</li>
                                    <li>ENCARGADO DE SUCURSAL</li>
                                    <li>CAJERA</li>
                                    <li>ALMACEN</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paso 4: Horario -->
                <div class="tutorial-step" data-step="4">
                    <h3><i class="fas fa-clock"></i> Paso 3: Asignar horario de trabajo</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Horario:</label>
                            <select class="form-select demo-input" disabled>
                                <option>Seleccionar horario...</option>
                                <option>Horario Oficina (8:00-17:00)</option>
                                <option>Turno Matutino (6:00-14:00)</option>
                                <option>Turno Vespertino (14:00-22:00)</option>
                            </select>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Horario de trabajo</h4>
                            <p>Selecciona el horario que seguir√° el empleado. Este horario determina las horas de entrada y salida esperadas.</p>
                            <div class="warning-box">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Importante:</strong> El horario debe existir previamente. Si no encuentras el horario adecuado, cr√©alo primero en la secci√≥n "Horarios".
                            </div>
                            <div class="tips">
                                <strong>üí° ¬øQu√© incluye un horario?</strong>
                                <ul>
                                    <li>Hora de entrada y salida</li>
                                    <li>Bloques de trabajo (si hay turnos partidos)</li>
                                    <li>Tolerancia de retardo</li>
                                    <li>Horas objetivo diarias</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paso 5: Foto y extras -->
                <div class="tutorial-step" data-step="5">
                    <h3><i class="fas fa-camera"></i> Paso 4: Foto y configuraci√≥n adicional</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Foto de Perfil:</label>
                            <div class="file-upload-demo">
                                <i class="fas fa-image fa-2x"></i>
                                <p>Haz clic para seleccionar una foto</p>
                            </div>
                            <span class="optional-badge">Opcional</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Foto de perfil</h4>
                            <p>Sube una foto del empleado para facilitar su identificaci√≥n.</p>
                            <div class="tips">
                                <strong>üí° Recomendaciones:</strong>
                                <ul>
                                    <li>Usa una foto reciente y clara</li>
                                    <li>Formato recomendado: JPG o PNG</li>
                                    <li>Tama√±o m√°ximo: 5 MB</li>
                                    <li>La foto aparecer√° en la tablet al hacer check-in</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>
                                <input type="checkbox" class="demo-checkbox" disabled>
                                Trabaja domingos
                            </label>
                        </div>
                        <div class="field-explanation">
                            <h4>Trabaja domingos</h4>
                            <p>Marca esta casilla si el empleado trabaja los domingos.</p>
                            <div class="tips">
                                <strong>üí° Nota:</strong> Esto afecta c√≥mo se calculan las asistencias y reportes semanales.
                            </div>
                        </div>
                    </div>

                    <div class="success-box">
                        <i class="fas fa-check-circle"></i>
                        <h4>¬°Listo para guardar!</h4>
                        <p>Una vez que hayas llenado todos los campos obligatorios, presiona el bot√≥n "Guardar" y el empleado ser√° dado de alta en el sistema.</p>
                    </div>

                    <div class="next-steps">
                        <h4><i class="fas fa-forward"></i> ¬øQu√© sigue despu√©s?</h4>
                        <ol>
                            <li>El empleado aparecer√° en la lista de empleados</li>
                            <li>Podr√°s imprimir su c√≥digo QR para que lo use en las tablets</li>
                            <li>Empezar√° a registrar asistencias seg√∫n su horario</li>
                            <li>Podr√°s ver sus registros en la secci√≥n "Registros"</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer tutorial-footer">
            <button class="btn btn-secondary" id="btnTutorialPrev" onclick="anteriorPasoTutorial()">
                <i class="fas fa-arrow-left"></i> Anterior
            </button>
            <div class="tutorial-step-counter">
                <span id="tutorialCurrentStep">1</span> / 5
            </div>
            <button class="btn btn-primary" id="btnTutorialNext" onclick="siguientePasoTutorial()">
                Siguiente <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-success" id="btnTutorialFinish" onclick="finalizarTutorial()" style="display: none;">
                <i class="fas fa-check"></i> ¬°Entendido! Crear empleado
            </button>
        </div>
    </div>
</div>

<!-- MODAL PARA EDITAR HORARIOS - AGREGAR AL FINAL DE INDEX.HTML -->
<div id="horarioModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="modalHorarioTitle">Editar Horario</h2>
            <span class="close" onclick="closeHorarioModal()">&times;</span>
        </div>
        
        <div class="modal-body">
            <form id="horarioForm" onsubmit="saveHorario(event)">
                <input type="hidden" id="horarioId" name="horario_id">
                
                <!-- Informaci√≥n b√°sica -->
                <div class="form-section">
                    <h3>Informaci√≥n General</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="horarioNombre">Nombre del Horario *</label>
                            <input type="text" id="horarioNombre" name="nombre" required 
                                   placeholder="Ej: Horario Oficina">
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label for="horarioDescripcion">Descripci√≥n</label>
                            <input type="text" id="horarioDescripcion" name="descripcion" 
                                   placeholder="Descripci√≥n del horario">
                        </div>
                    </div>
                </div>
                
                <!-- Bloques de horario -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Bloques de Horario</h3>
                        <button type="button" class="btn btn-secondary" onclick="agregarBloqueHorario()">
                            <i class="fas fa-plus"></i> Agregar Bloque
                        </button>
                    </div>
                    <div id="bloquesContainer" class="bloques-container">
                        <!-- Los bloques se agregan din√°micamente aqu√≠ -->
                    </div>
                </div>
                
                <!-- Botones de acci√≥n -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeHorarioModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Horario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL RESUMEN GENERAL -->
<div id="modalResumenGeneral" class="modal">
    <div class="modal-content modal-large" style="max-width: 95%; max-height: 90vh;">
        <div class="modal-header">
            <h3><i class="fas fa-table"></i> Resumen General de Empleados</h3>
            <span class="close" onclick="cerrarResumenGeneral()">&times;</span>
        </div>

        <div class="modal-body">
            <!-- Controles superiores -->
            <div class="resumen-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 12px; background: #f8fafc; border-radius: 8px;">
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="text" id="filtroResumenGeneral" placeholder="üîç Buscar empleado..."
                           class="form-input" style="min-width: 250px;" onkeyup="filtrarResumenGeneral()">
                    <select id="filtroSucursalResumen" class="form-select" onchange="filtrarResumenGeneral()">
                        <option value="">Todas las sucursales</option>
                    </select>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-success" onclick="exportarResumenGeneral()">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                    <button class="btn btn-secondary" onclick="imprimirResumenGeneral()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>

            <!-- Tabla resumen -->
            <div class="table-container" style="max-height: 60vh; overflow-y: auto;">
                <table id="tablaResumenGeneral" class="registros-table-advanced">
                    <thead>
                        <tr>
                            <th onclick="ordenarResumenGeneral('empleado')" style="cursor: pointer;">
                                Empleado <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('sucursal')" style="cursor: pointer;">
                                Sucursal <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('horas')" style="cursor: pointer;">
                                Horas Trabajadas <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('entradas')" style="cursor: pointer;">
                                Entradas <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('salidas')" style="cursor: pointer;">
                                Salidas <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('faltas')" style="cursor: pointer;">
                                Faltas <i class="fas fa-sort"></i>
                            </th>
                            <th onclick="ordenarResumenGeneral('retardos')" style="cursor: pointer;">
                                Minutos Retardo <i class="fas fa-sort"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="bodyResumenGeneral">
                        <!-- Se llena din√°micamente -->
                    </tbody>
                </table>
            </div>

            <!-- Estad√≠sticas generales -->
            <div id="statsResumenGeneral" style="margin-top: 16px; padding: 14px; background: #f8fafc; border-radius: 8px; display: flex; justify-content: space-around; font-size: 0.85rem;">
                <!-- Se llena din√°micamente -->
            </div>
        </div>

        <!-- Panel de detalle por empleado (slide-in) -->
        <div id="panelDetalleEmpleado" class="panel-detalle-empleado">
            <!-- Se llena din√°micamente -->
        </div>
    </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: PANEL DE ALERTAS DEL D√çA
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="modalAlertas" style="display:none;position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,.55);align-items:flex-start;justify-content:flex-end;">
    <div style="background:#0f172a;border-left:1px solid #1e293b;height:100%;width:100%;max-width:420px;display:flex;flex-direction:column;animation:slideInRight .3s ease;">
        <!-- Header -->
        <div style="padding:20px 24px;border-bottom:1px solid #1e293b;display:flex;align-items:center;justify-content:space-between;">
            <div style="display:flex;align-items:center;gap:10px;">
                <i class="fas fa-bell" style="color:#f59e0b;font-size:18px;"></i>
                <h3 style="margin:0;color:#f1f5f9;font-size:16px;">Alertas del d√≠a</h3>
                <span id="alertasTotalBadge" style="background:#ef4444;color:#fff;border-radius:20px;padding:2px 8px;font-size:12px;font-weight:700;"></span>
            </div>
            <button onclick="cerrarPanelAlertas()" style="background:none;border:none;color:#64748b;font-size:20px;cursor:pointer;padding:0 4px;">√ó</button>
        </div>
        <!-- Contenido -->
        <div id="alertasContenido" style="flex:1;overflow-y:auto;padding:16px 24px;">
            <div style="color:#64748b;text-align:center;padding:40px 0;">
                <i class="fas fa-spinner fa-spin" style="font-size:24px;"></i>
                <p style="margin-top:12px;">Cargando alertas...</p>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: EXPEDIENTE DIGITAL DEL EMPLEADO
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="modalExpediente" style="display:none;position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,.6);align-items:flex-start;justify-content:flex-end;">
    <div style="background:#0f172a;border-left:1px solid #1e293b;height:100%;width:100%;max-width:680px;display:flex;flex-direction:column;animation:slideInRight .3s ease;overflow:hidden;">
        <!-- Header -->
        <div style="padding:20px 28px;border-bottom:1px solid #1e293b;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
            <div style="display:flex;align-items:center;gap:12px;">
                <div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#6366f1);display:flex;align-items:center;justify-content:center;">
                    <i class="fas fa-id-card" style="color:#fff;font-size:18px;"></i>
                </div>
                <div>
                    <h3 id="expedienteNombre" style="margin:0;color:#f1f5f9;font-size:17px;font-weight:600;">Expediente Digital</h3>
                    <span id="expedienteCodigo" style="color:#64748b;font-size:13px;"></span>
                </div>
            </div>
            <button onclick="cerrarExpediente()" style="background:none;border:none;color:#64748b;font-size:22px;cursor:pointer;padding:0 4px;line-height:1;">√ó</button>
        </div>
        <!-- Contenido scrollable -->
        <div id="expedienteContenido" style="flex:1;overflow-y:auto;padding:24px 28px;">
            <div style="color:#64748b;text-align:center;padding:60px 0;">
                <i class="fas fa-spinner fa-spin" style="font-size:28px;"></i>
                <p style="margin-top:14px;">Cargando expediente...</p>
            </div>
        </div>
    </div>
</div>

</body>

</html>
