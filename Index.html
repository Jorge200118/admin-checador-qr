<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Checador QR</title>
    <link rel="stylesheet" href="Admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <i class="fas fa-qrcode"></i>
            <h2>Checador QR</h2>
        </div>
        
        <nav class="nav-menu">
            <ul>
                <li class="nav-item active">
                    <a href="#dashboard" data-section="dashboard">
                        <i class="fas fa-dashboard"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#empleados" data-section="empleados">
                        <i class="fas fa-users"></i>
                        <span>Empleados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#horarios" data-section="horarios">
                        <i class="fas fa-clock"></i>
                        <span>Horarios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#registros" data-section="registros">
                        <i class="fas fa-list"></i>
                        <span>Registros</span>
                    </a>
                </li>
           <!-- <li class="nav-item">
                    <a href="#reportes" data-section="reportes">
                        <i class="fas fa-chart-line"></i>
                        <span>Reportes</span>
                    </a>
                </li> -->
                <li class="nav-item">
                    <a href="#configuracion" data-section="configuracion">
                        <i class="fas fa-cog"></i>
                        <span>Configuraci贸n</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <h1 id="pageTitle">Dashboard</h1>
            <div class="header-actions">
                <div class="status-indicator">
                    <span class="status-dot online"></span>
                    <span>Sistema activo</span>
                </div>
                <button class="btn btn-logout" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt"></i>
                    Salir
                </button>
                <div class="user-info" style="margin-right: 15px; color: #666;">
                    <i class="fas fa-user"></i>
                    <span id="userNameDisplay"></span>
                    <span style="font-size: 12px;">(<span id="userSucursalDisplay"></span>)</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="empleadosPresentes">0</h3>
                        <p>Empleados Presentes</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="registrosHoy">0</h3>
                        <p>Registros Hoy</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="llegadasTarde">0</h3>
                        <p>Llegadas Tarde</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tablet-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="tabletsActivas">2</h3>
                        <p>Tablets Activas</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Empleados Presentes Hoy</h3>
                        <button class="btn btn-sm btn-primary" onclick="refreshDashboard()">
                            <i class="fas fa-refresh"></i> Actualizar
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="empleadosPresentesTable">
                                <thead>
                                    <tr>
                                        <th>Empleado</th>
                                        <th>Entrada</th>
                                        <th>Salida Esperada</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>ltimos Registros</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="ultimosRegistrosTable">
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Empleado</th>
                                        <th>Tipo</th>
                                        <th>Tablet</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Empleados Section -->
        <section id="empleados" class="content-section">
            <div class="section-header">
                <h2>Gesti贸n de Empleados</h2>
                <div class="header-actions-group">
                    <button class="btn btn-info" id="btnTutorialEmpleado" onclick="iniciarTutorialEmpleado()">
                        <i class="fas fa-question-circle"></i> Tutorial
                    </button>
                    <button class="btn btn-primary" id="btnNuevoEmpleado">
                        <i class="fas fa-plus"></i> Nuevo Empleado
                    </button>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <input type="text" id="searchEmpleados" placeholder="Buscar empleados..." class="form-input">
                    <select id="filterHorario" class="form-select">
                        <option value="">Todos los horarios</option>
                        <!-- Options loaded by JavaScript -->
                    </select>
                    <select id="filterEstado" class="form-select">
                        <option value="">Todos los estados</option>
                        <option value="1">Activos</option>
                        <option value="0">Inactivos</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="empleadosTable">
                            <thead>
                                <tr>
                                    <th>Foto</th>
                                    <th>C贸digo</th>
                                    <th>Nombre</th>
                                    <th>Sucursal</th>
                                    <th>Puesto</th>
                                    <th>Horario</th>
                                    <th>Estado</th>
                                    <th>Fecha Alta</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Horarios Section -->
        <section id="horarios" class="content-section">
            <div class="section-header">
                <h2>Gesti贸n de Horarios</h2>
                <button class="btn btn-primary" id="btnNuevoHorario">
                    <i class="fas fa-plus"></i> Nuevo Horario
                </button>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="horariosTable">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripci贸n</th>
                                    <th>Bloques</th>
                                    <th>Empleados</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registros Section -->
        <section id="registros" class="content-section">
            <!-- Header con per铆odo y estad铆sticas -->
            <div class="registros-header">
                <div class="periodo-info">
                    <h2>Registros de Asistencia</h2>
                    <div class="periodo-actual">
                        <span class="periodo-label">Per铆odo:</span>
                        <span class="periodo-fechas" id="periodoActual">18/11/2025 - 18/11/2025</span>
                    </div>
                </div>
                
                <!-- Estad铆sticas r谩pidas -->
                <div class="stats-quick">
                    <div class="stat-item">
                        <span class="stat-label">Registros sin check</span>
                        <span class="stat-number" id="registrosSinCheck">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Registros</span>
                        <span class="stat-number" id="totalRegistros">132</span>
                    </div>
                </div>
            </div>

            <!-- Filtros mejorados -->
            <div class="filters-advanced">
                <div class="filters-row">
                    <!-- Filtros de fecha -->
                    <div class="filter-group dates">
                        <label>Per铆odo:</label>
                        <div class="date-inputs">
                            <input type="date" id="fechaInicio" class="form-input" placeholder="Fecha inicio">
                            <span class="date-separator">-</span>
                            <input type="date" id="fechaFin" class="form-input" placeholder="Fecha fin">
                        </div>
                    </div>
                    
                    <!-- Filtro de empleado con autocompletar -->
                    <div class="filter-group">
                        <label>Empleado:</label>
                        <div class="autocomplete-container">
                            <input type="text" id="filterEmpleadoBusqueda" class="form-input" 
                                placeholder="Buscar empleado..." autocomplete="off">
                            <div id="empleadosSuggestions" class="autocomplete-suggestions"></div>
                            <input type="hidden" id="filterEmpleado" value="">
                        </div>
                    </div>
                    
                    <!-- Filtro de tipo -->
                    <div class="filter-group">
                        <label>Tipo:</label>
                        <select id="filterTipo" class="form-select">
                            <option value="">TODOS LOS TIPOS</option>
                            <option value="ENTRADA">Entradas</option>
                            <option value="SALIDA">Salidas</option>
                        </select>
                    </div>
                    
                    <!-- Filtro de sucursal -->
                    <div class="filter-group">
                        <label>Sucursal:</label>
                        <select id="filterSucursal" class="form-select">
                            <option value="">TODAS LAS SUCURSALES</option>
                            <option value="MATRIZ">MATRIZ</option>
                            <option value="TAMARAL">TAMARAL</option>
                            <option value="CABOS">CABOS</option>
                            <option value="LA PAZ">LA PAZ</option>
                            <option value="SAN JOSE">SAN JOSE</option>
                            <option value="CULIACAN">CULIACAN</option>
                            <option value="JUAN JOSE RIOS">JUAN JOSE RIOS</option>
                            <option value="EL FUERTE">EL FUERTE</option>
                        </select>
                    </div>
                    
                    <!-- Filtro de puesto -->
                    <div class="filter-group">
                        <label>Puesto:</label>
                        <select id="filterPuesto" class="form-select">
                            <option value="">TODOS LOS PUESTOS</option>
                            <option value="VENTAS">VENTAS</option>
                            <option value="CHOFER">CHOFER</option>
                            <option value="TRABAJADOR DE PATIO">TRABAJADOR DE PATIO</option>
                            <option value="AUXILIAR CONTABLE">AUXILIAR CONTABLE</option>
                            <option value="ENCARGADO DE SUCURSAL">ENCARGADO DE SUCURSAL</option>
                            <option value="CAJERA">CAJERA</option>
                            <option value="ALMACEN">ALMACEN</option>
                            <!-- M谩s opciones cargadas din谩micamente -->
                        </select>
                    </div>
                </div>
                
                <!-- Botones de acci贸n -->
                <div class="filter-actions">
                    <button class="btn btn-primary filter-btn" onclick="filtrarRegistros()">
                        <i class="fas fa-search"></i> Filtrar
                    </button>
                    <button class="btn btn-info" onclick="mostrarReporteEjecutivo()" title="Reporte ejecutivo de productividad">
                        <i class="fas fa-chart-line"></i> Resumen empleado
                    </button>
                    <button class="btn btn-secondary" onclick="limpiarFiltros()">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>

            <!-- Secci贸n de descarga de faltas mejorada -->
            <div class="faltas-download-section">
                <div class="section-title">
                    <i class="fas fa-download"></i>
                    <strong>Descargar Faltas por Rango</strong>
                </div>
                
                <div class="download-controls">
                    <div class="date-range-group">
                        <label>Desde:</label>
                        <input type="date" id="fecha-inicio-faltas" class="form-input-small">
                        
                        <label>Hasta:</label>
                        <input type="date" id="fecha-fin-faltas" class="form-input-small">
                    </div>
                    
                    <button id="btn-descargar-faltas" onclick="obtenerEmpleadosSinEntradaRango(event)" class="btn btn-success">
                        <i class="fas fa-file-excel"></i> Descargar Rango
                    </button>
                </div>
                
                <div class="download-hint">
                     Descarga todas las faltas del per铆odo seleccionado en un solo Excel
                </div>
            </div>


            <!-- Controles de tabla -->
            <div class="table-controls">
                
                <div class="table-actions">
                    <button class="btn-icon" title="Imprimir" onclick="imprimirRegistros()">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="btn-icon" title="Exportar Excel" onclick="exportarRegistros('excel')">
                        <i class="fas fa-file-excel"></i>
                    </button>
                    <button class="btn-icon" title="Exportar PDF" onclick="exportarRegistros('pdf')">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                    <button class="btn-icon" title="Actualizar" onclick="reloadRegistros()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn-icon" title="Configurar columnas" onclick="configurarColumnas()">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- Tabla principal -->
            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <table id="registrosTable" class="registros-table-advanced">
                            <!-- Modificar tu thead -->
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAllRegistros" onchange="toggleSelectAll()">
                                    </th>
                                    <th>Empleado</th>
                                    <th>Fecha</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Hrs Trabajadas</th>
                                    <th>Hrs Objetivo</th>
                                    <th>Estatus</th>
                                    <th>Tablet</th>
                                    <th>Foto</th>
                                    <th>Todas las fotos</th> <!-- NUEVA COLUMNA -->
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Paginaci贸n -->
          <!--    <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Mostrando registros del 1 al 10 de un total de 132</span>
                </div>
                
              <!--   <div class="pagination-controls">
                    <button class="btn-pagination" id="btnAnterior" onclick="cambiarPagina(-1)">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    
                    <div class="pagination-numbers" id="paginationNumbers">
                        <button class="btn-page active">1</button>
                        <button class="btn-page">2</button>
                        <button class="btn-page">3</button>
                        <span class="pagination-dots">...</span>
                        <button class="btn-page">14</button>
                    </div>
                    
                    <button class="btn-pagination" id="btnSiguiente" onclick="cambiarPagina(1)">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>-->
        </section>

        <!-- Reportes Section 
        <section id="reportes" class="content-section">
            <div class="section-header">
                <h2>Reportes y Estad铆sticas</h2>
            </div>

            <div class="reports-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Reporte de Asistencia</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Per铆odo:</label>
                            <div class="date-range">
                                <input type="date" id="reporteFechaInicio" class="form-input">
                                <span>hasta</span>
                                <input type="date" id="reporteFechaFin" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Empleado:</label>
                            <select id="reporteEmpleado" class="form-select">
                                <option value="">Todos</option>
                                <!-- Options loaded by JavaScript 
                            </select>
                        </div>
                        <button onclick="generarReporteAsistencia()" class="btn btn-primary">
                             Generar Reporte
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Estad铆sticas del Mes</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="chartAsistencia" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section> -->

        <!-- Configuraci贸n Section -->
        <section id="configuracion" class="content-section">
            <div class="section-header">
                <h2>Configuraci贸n del Sistema</h2>
            </div>

            <div class="config-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Tablets Registradas</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="tabletsTable">
                                <thead>
                                    <tr>
                                        <th>ID Tablet</th>
                                        <th>Ubicaci贸n</th>
                                        <th>Estado</th>
                                        <th>ltimo Ping</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data loaded by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Configuraci贸n General</h3>
                    </div>
                    <div class="card-body">
                        <div class="config-form">
                            <div class="form-group">
                                <label>Tolerancia por defecto (minutos):</label>
                                <input type="number" id="toleranciaDefecto" class="form-input" value="15">
                            </div>
                            <div class="form-group">
                                <label>Tama帽o m谩ximo de foto (MB):</label>
                                <input type="number" id="maxFotoSize" class="form-input" value="5">
                            </div>
                            <div class="form-group">
                                <label>Auto-logout admin (minutos):</label>
                                <input type="number" id="autoLogout" class="form-input" value="60">
                            </div>
                            <button class="btn btn-primary" onclick="guardarConfiguracion()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="modalEmpleado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEmpleadoTitle">Nuevo Empleado</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formEmpleado" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>C贸digo de Empleado:</label>
                        <input type="text" id="empCodigo" name="codigo" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre:</label>
                        <input type="text" id="empNombre" name="nombre" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Apellido:</label>
                        <input type="text" id="empApellido" name="apellido" class="form-input" required>
                    </div>
                    <!-- AGREGAR ESTOS DOS CAMPOS NUEVOS -->
                    <div class="form-group">
                        <label>Sucursal:</label>
                        <select id="empSucursal" name="sucursal" class="form-select">
                            <option value="">Seleccionar sucursal</option>
                            <option value="MATRIZ">MATRIZ</option>
                            <option value="LA PAZ">LA PAZ</option>
                            <option value="SAN JOSE">SAN JOSE</option>
                            <option value="TAMARAL">TAMARAL</option>
                            <option value="CABOS">CABOS</option>
                            <option value="EL FUERTE">EL FUERTE</option>
                            <option value="JUAN JOSE RIOS">JUAN JOSE RIOS</option>
                            <option value="CULIACAN">CULIACAN</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puesto:</label>
                        <input type="text" id="empPuesto" name="puesto" class="form-input" 
                            placeholder="Ej: VENTAS, ALMACN, ENCARGADO DE PATIO">
                    </div>
                    <!-- FIN DE CAMPOS NUEVOS -->
                    <div class="form-group">
                        <label>Horario:</label>
                        <select id="empHorario" name="horario_id" class="form-select" required>
                            <!-- Options loaded by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Foto de Perfil:</label>
                        <input type="file" id="empFoto" name="foto" class="form-input" accept="image/*">
                        <div id="previewFoto" class="foto-preview"></div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="empTrabajaDomingo" name="trabaja_domingo">
                            Trabaja domingos
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalEmpleado')">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarEmpleado()">Guardar</button>
            </div>
        </div>
    </div>
    <script>
    // Configuraci贸n global para evitar errores
    window.ADMIN_CONFIG = {
        apiUrl: 'http://localhost:3000/api'
    };
    </script>

    <!-- Verificaci贸n de sesi贸n - DEBE IR PRIMERO -->
    <script>
        // Verificar sesi贸n antes de cargar la p谩gina
        (function() {
            const session = localStorage.getItem('session_sucursal') ||
                           sessionStorage.getItem('session_sucursal');

            if (!session) {
                // No hay sesi贸n, redirigir al login
                window.location.href = '../login-sucursal.html';
                return;
            }

            try {
                const sessionData = JSON.parse(session);

                // Verificar que la sesi贸n no haya expirado (24 horas)
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);

                if (hoursSinceLogin > 24) {
                    // Sesi贸n expirada
                    localStorage.removeItem('session_sucursal');
                    sessionStorage.removeItem('session_sucursal');
                    window.location.href = '../login-sucursal.html';
                    return;
                }

                // Sesi贸n v谩lida, guardar datos globalmente
                window.currentUser = sessionData;
                console.log('Usuario logueado:', sessionData.nombreCompleto, '- Sucursal:', sessionData.sucursal);

                // Mostrar informaci贸n del usuario cuando la p谩gina cargue
                window.addEventListener('DOMContentLoaded', function() {
                    const userNameEl = document.getElementById('userNameDisplay');
                    const userSucursalEl = document.getElementById('userSucursalDisplay');

                    if (userNameEl) userNameEl.textContent = sessionData.nombreCompleto;
                    if (userSucursalEl) userSucursalEl.textContent = sessionData.sucursal;
                });

            } catch (error) {
                // Sesi贸n corrupta
                console.error('Error al verificar sesi贸n:', error);
                localStorage.removeItem('session_sucursal');
                sessionStorage.removeItem('session_sucursal');
                window.location.href = '../login-sucursal.html';
            }
        })();

        // Funci贸n para cerrar sesi贸n
        function cerrarSesion() {
            if (confirm('驴Est谩s seguro de que deseas cerrar sesi贸n?')) {
                // Limpiar sesiones
                localStorage.removeItem('session_sucursal');
                sessionStorage.removeItem('session_sucursal');

                // Limpiar datos del usuario
                window.currentUser = null;

                // Redirigir al login
                window.location.href = '../login-sucursal.html';
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="Admin.js"></script>
<!-- MODAL DE TUTORIAL PARA NUEVO EMPLEADO -->
<div id="modalTutorialEmpleado" class="modal">
    <div class="modal-content modal-tutorial">
        <div class="modal-header">
            <h3><i class="fas fa-graduation-cap"></i> Tutorial: C贸mo dar de alta un nuevo empleado</h3>
            <span class="close" onclick="cerrarTutorialEmpleado()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Navegaci贸n de pasos -->
            <div class="tutorial-progress">
                <div class="step-indicator active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Introducci贸n</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Datos b谩sicos</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Ubicaci贸n</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Horario</div>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Foto y extras</div>
                </div>
            </div>

            <!-- Contenido de pasos -->
            <div class="tutorial-content">
                <!-- Paso 1: Introducci贸n -->
                <div class="tutorial-step active" data-step="1">
                    <div class="step-icon">
                        <i class="fas fa-user-plus fa-3x"></i>
                    </div>
                    <h3>Bienvenido al asistente de alta de empleados</h3>
                    <p>Este tutorial te guiar谩 paso a paso para registrar un nuevo empleado en el sistema de checador QR.</p>

                    <div class="info-box">
                        <h4><i class="fas fa-info-circle"></i> 驴Qu茅 necesitas tener listo?</h4>
                        <ul>
                            <li><i class="fas fa-check"></i> C贸digo 煤nico del empleado</li>
                            <li><i class="fas fa-check"></i> Nombre completo</li>
                            <li><i class="fas fa-check"></i> Sucursal donde trabajar谩</li>
                            <li><i class="fas fa-check"></i> Puesto o cargo</li>
                            <li><i class="fas fa-check"></i> Horario asignado</li>
                            <li><i class="fas fa-check"></i> Foto de perfil (opcional)</li>
                        </ul>
                    </div>

                    <div class="time-estimate">
                        <i class="fas fa-clock"></i> Tiempo estimado: <strong>2-3 minutos</strong>
                    </div>
                </div>

                <!-- Paso 2: Datos b谩sicos -->
                <div class="tutorial-step" data-step="2">
                    <h3><i class="fas fa-id-card"></i> Paso 1: Datos b谩sicos del empleado</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>C贸digo de Empleado:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: EMP001" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>C贸digo de Empleado</h4>
                            <p>Es el identificador 煤nico del empleado. Puede ser un n煤mero de n贸mina, un c贸digo alfanum茅rico, etc.</p>
                            <div class="tips">
                                <strong> Consejos:</strong>
                                <ul>
                                    <li>Usa un formato consistente (Ej: EMP001, EMP002)</li>
                                    <li>No puede repetirse con otro empleado</li>
                                    <li>Aseg煤rate de que sea f谩cil de recordar</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Nombre:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: Juan" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Nombre</h4>
                            <p>Nombre(s) del empleado.</p>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Apellido:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: P茅rez Garc铆a" readonly>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Apellido</h4>
                            <p>Apellido(s) del empleado.</p>
                        </div>
                    </div>
                </div>

                <!-- Paso 3: Ubicaci贸n y puesto -->
                <div class="tutorial-step" data-step="3">
                    <h3><i class="fas fa-building"></i> Paso 2: Sucursal y puesto de trabajo</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Sucursal:</label>
                            <select class="form-select demo-input" disabled>
                                <option>Seleccionar sucursal</option>
                                <option>MATRIZ</option>
                                <option>LA PAZ</option>
                                <option>TAMARAL</option>
                                <option>CABOS</option>
                            </select>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Sucursal</h4>
                            <p>Selecciona la sucursal donde el empleado estar谩 asignado.</p>
                            <div class="tips">
                                <strong> Importante:</strong>
                                <ul>
                                    <li>Esta informaci贸n se usar谩 para filtrar reportes</li>
                                    <li>El empleado solo aparecer谩 en las tablets de su sucursal</li>
                                    <li>Puedes cambiar la sucursal despu茅s editando el empleado</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Puesto:</label>
                            <input type="text" class="form-input demo-input" placeholder="Ej: VENTAS, ALMACN, ENCARGADO" readonly>
                        </div>
                        <div class="field-explanation">
                            <h4>Puesto</h4>
                            <p>Especifica el cargo o puesto del empleado.</p>
                            <div class="tips">
                                <strong> Ejemplos comunes:</strong>
                                <ul>
                                    <li>VENTAS</li>
                                    <li>CHOFER</li>
                                    <li>TRABAJADOR DE PATIO</li>
                                    <li>AUXILIAR CONTABLE</li>
                                    <li>ENCARGADO DE SUCURSAL</li>
                                    <li>CAJERA</li>
                                    <li>ALMACEN</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paso 4: Horario -->
                <div class="tutorial-step" data-step="4">
                    <h3><i class="fas fa-clock"></i> Paso 3: Asignar horario de trabajo</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Horario:</label>
                            <select class="form-select demo-input" disabled>
                                <option>Seleccionar horario...</option>
                                <option>Horario Oficina (8:00-17:00)</option>
                                <option>Turno Matutino (6:00-14:00)</option>
                                <option>Turno Vespertino (14:00-22:00)</option>
                            </select>
                            <span class="required-badge">Obligatorio</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Horario de trabajo</h4>
                            <p>Selecciona el horario que seguir谩 el empleado. Este horario determina las horas de entrada y salida esperadas.</p>
                            <div class="warning-box">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Importante:</strong> El horario debe existir previamente. Si no encuentras el horario adecuado, cr茅alo primero en la secci贸n "Horarios".
                            </div>
                            <div class="tips">
                                <strong> 驴Qu茅 incluye un horario?</strong>
                                <ul>
                                    <li>Hora de entrada y salida</li>
                                    <li>Bloques de trabajo (si hay turnos partidos)</li>
                                    <li>Tolerancia de retardo</li>
                                    <li>Horas objetivo diarias</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paso 5: Foto y extras -->
                <div class="tutorial-step" data-step="5">
                    <h3><i class="fas fa-camera"></i> Paso 4: Foto y configuraci贸n adicional</h3>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>Foto de Perfil:</label>
                            <div class="file-upload-demo">
                                <i class="fas fa-image fa-2x"></i>
                                <p>Haz clic para seleccionar una foto</p>
                            </div>
                            <span class="optional-badge">Opcional</span>
                        </div>
                        <div class="field-explanation">
                            <h4>Foto de perfil</h4>
                            <p>Sube una foto del empleado para facilitar su identificaci贸n.</p>
                            <div class="tips">
                                <strong> Recomendaciones:</strong>
                                <ul>
                                    <li>Usa una foto reciente y clara</li>
                                    <li>Formato recomendado: JPG o PNG</li>
                                    <li>Tama帽o m谩ximo: 5 MB</li>
                                    <li>La foto aparecer谩 en la tablet al hacer check-in</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-field">
                        <div class="field-demo">
                            <label>
                                <input type="checkbox" class="demo-checkbox" disabled>
                                Trabaja domingos
                            </label>
                        </div>
                        <div class="field-explanation">
                            <h4>Trabaja domingos</h4>
                            <p>Marca esta casilla si el empleado trabaja los domingos.</p>
                            <div class="tips">
                                <strong> Nota:</strong> Esto afecta c贸mo se calculan las asistencias y reportes semanales.
                            </div>
                        </div>
                    </div>

                    <div class="success-box">
                        <i class="fas fa-check-circle"></i>
                        <h4>隆Listo para guardar!</h4>
                        <p>Una vez que hayas llenado todos los campos obligatorios, presiona el bot贸n "Guardar" y el empleado ser谩 dado de alta en el sistema.</p>
                    </div>

                    <div class="next-steps">
                        <h4><i class="fas fa-forward"></i> 驴Qu茅 sigue despu茅s?</h4>
                        <ol>
                            <li>El empleado aparecer谩 en la lista de empleados</li>
                            <li>Podr谩s imprimir su c贸digo QR para que lo use en las tablets</li>
                            <li>Empezar谩 a registrar asistencias seg煤n su horario</li>
                            <li>Podr谩s ver sus registros en la secci贸n "Registros"</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer tutorial-footer">
            <button class="btn btn-secondary" id="btnTutorialPrev" onclick="anteriorPasoTutorial()">
                <i class="fas fa-arrow-left"></i> Anterior
            </button>
            <div class="tutorial-step-counter">
                <span id="tutorialCurrentStep">1</span> / 5
            </div>
            <button class="btn btn-primary" id="btnTutorialNext" onclick="siguientePasoTutorial()">
                Siguiente <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-success" id="btnTutorialFinish" onclick="finalizarTutorial()" style="display: none;">
                <i class="fas fa-check"></i> 隆Entendido! Crear empleado
            </button>
        </div>
    </div>
</div>

<!-- MODAL PARA EDITAR HORARIOS - AGREGAR AL FINAL DE INDEX.HTML -->
<div id="horarioModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="modalHorarioTitle">Editar Horario</h2>
            <span class="close" onclick="closeHorarioModal()">&times;</span>
        </div>
        
        <div class="modal-body">
            <form id="horarioForm" onsubmit="saveHorario(event)">
                <input type="hidden" id="horarioId" name="horario_id">
                
                <!-- Informaci贸n b谩sica -->
                <div class="form-section">
                    <h3>Informaci贸n General</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="horarioNombre">Nombre del Horario *</label>
                            <input type="text" id="horarioNombre" name="nombre" required 
                                   placeholder="Ej: Horario Oficina">
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label for="horarioDescripcion">Descripci贸n</label>
                            <input type="text" id="horarioDescripcion" name="descripcion" 
                                   placeholder="Descripci贸n del horario">
                        </div>
                    </div>
                </div>
                
                <!-- Bloques de horario -->
                <div class="form-section">
                    <div class="section-header">
                        <h3>Bloques de Horario</h3>
                        <button type="button" class="btn btn-secondary" onclick="agregarBloqueHorario()">
                            <i class="fas fa-plus"></i> Agregar Bloque
                        </button>
                    </div>
                    <div id="bloquesContainer" class="bloques-container">
                        <!-- Los bloques se agregan din谩micamente aqu铆 -->
                    </div>
                </div>
                
                <!-- Botones de acci贸n -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeHorarioModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Horario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>

</html>
